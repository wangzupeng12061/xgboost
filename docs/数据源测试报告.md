# 数据源测试报告

## 测试时间
2025-11-03

## 测试结果

### 1. Tushare 测试
**状态**: ❌ 权限不足

**问题**: 
- 您的 Tushare token 权限级别较低
- 大部分接口需要更高的积分权限才能访问
- 建议访问 https://tushare.pro/document/1?doc_id=108 查看权限详情

**解决方案**:
1. 升级 Tushare 积分（通过分享、打赏等方式）
2. 使用 AKShare 作为替代数据源（推荐）

---

### 2. AKShare 测试
**状态**: ✅ 成功

**测试项目**:
- ✅ 获取A股股票列表: 5445只股票
- ✅ 获取日线数据: 成功获取平安银行(000001)的历史数据
- ✅ 获取指数数据: 成功获取上证指数历史数据
- ✅ 获取沪深300成分股: 300只成分股
- ⚠️ 获取实时行情: 网络连接问题（非关键功能）

**优势**:
- 完全免费，无需 token
- 覆盖A股、港股、美股等多个市场
- 数据更新及时
- 接口简单易用

---

## 建议

### 推荐配置
由于 AKShare 测试成功且无权限限制，建议使用 AKShare 作为数据源。

修改配置文件 `config/config.yaml`:

```yaml
data:
  source: "akshare"  # 改为 akshare
  # token 字段可以保留但不会被使用
  start_date: "2020-01-01"  # 建议使用更长的历史数据
  end_date: "2024-12-31"
  universe: "hs300"  # 建议先从沪深300开始测试
```

### 数据获取建议
1. **股票池**: 建议从沪深300或中证500开始，降低数据量
2. **时间范围**: 
   - 训练数据: 2020-01-01 至 2023-12-31
   - 测试数据: 2024-01-01 至 2024-12-31
3. **数据频率**: 日频数据足够用于因子分析

### 下一步操作
1. ✅ 修改 `config/config.yaml` 中的数据源为 `akshare`
2. 📝 修改 `src/data/data_loader.py` 添加 AKShare 数据获取逻辑
3. 🧪 运行完整的数据加载流程测试
4. 📊 开始因子计算和模型训练

---

## 技术说明

### AKShare 主要接口
```python
import akshare as ak

# 获取股票列表
stock_list = ak.stock_info_a_code_name()

# 获取日线数据（前复权）
df = ak.stock_zh_a_hist(
    symbol="000001",
    period="daily",
    start_date="20200101",
    end_date="20241231",
    adjust="qfq"  # 前复权
)

# 获取指数数据
index_df = ak.stock_zh_index_daily(symbol="sh000001")

# 获取沪深300成分股
hs300 = ak.index_stock_cons(symbol="000300")
```

### 数据字段映射
需要在 `DataLoader` 中进行字段映射：

| AKShare字段 | 标准字段 | 说明 |
|------------|---------|------|
| 日期 | date | 交易日期 |
| 股票代码 | ts_code | 股票代码 |
| 开盘 | open | 开盘价 |
| 收盘 | close | 收盘价 |
| 最高 | high | 最高价 |
| 最低 | low | 最低价 |
| 成交量 | volume | 成交量 |
| 成交额 | amount | 成交额 |
| 涨跌幅 | pct_change | 涨跌幅 |

---

## 附录：测试脚本

测试脚本已保存：
- `test_data_connection.py` - Tushare测试
- `test_akshare.py` - AKShare测试

可随时运行验证数据获取功能。
