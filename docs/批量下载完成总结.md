# æ‰¹é‡ä¸‹è½½å¤šå¸‚åœºè‚¡ç¥¨æ•°æ® - å®Œæˆæ€»ç»“

## ğŸ“‹ å·²å®ŒæˆåŠŸèƒ½

### 1. æ ¸å¿ƒè„šæœ¬

| æ–‡ä»¶ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|-----|
| `scripts/batch_download_data.py` | æ‰¹é‡ä¸‹è½½ä¸»è„šæœ¬ | âœ… å®Œæˆ |
| `scripts/download_data.sh` | äº¤äº’å¼å¯åŠ¨è„šæœ¬ | âœ… å®Œæˆ |
| `scripts/test_download.py` | åŠŸèƒ½æµ‹è¯•è„šæœ¬ | âœ… å®Œæˆ |
| `scripts/README.md` | è„šæœ¬ä½¿ç”¨è¯´æ˜ | âœ… å®Œæˆ |

### 2. æ”¯æŒçš„å¸‚åœº

| å¸‚åœº | ä»£ç  | æ”¯æŒæƒ…å†µ | æƒé™è¦æ±‚ |
|------|------|---------|---------|
| Aè‚¡ | a | âœ… å®Œæ•´æ”¯æŒ | åŸºç¡€æƒé™ |
| æ¸¯è‚¡ | hk | âœ… å®Œæ•´æ”¯æŒ | åŸºç¡€æƒé™ |
| ç¾è‚¡ | us | âœ… å®Œæ•´æ”¯æŒ | é«˜çº§æƒé™ |
| å…¨éƒ¨ | all | âœ… å®Œæ•´æ”¯æŒ | æ··åˆæƒé™ |

### 3. æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|-----|
| åˆ†æ‰¹ä¸‹è½½ | æ¯æ‰¹50åªï¼Œé¿å…é™æµ | âœ… |
| æ™ºèƒ½é‡è¯• | å¤±è´¥è‡ªåŠ¨é‡è¯•3æ¬¡ | âœ… |
| æ–­ç‚¹ç»­ä¼  | å·²ä¸‹è½½è‡ªåŠ¨è·³è¿‡ | âœ… |
| é™æµä¿æŠ¤ | è‡ªåŠ¨æ£€æµ‹å’Œç­‰å¾… | âœ… |
| è¿›åº¦è·Ÿè¸ª | å®æ—¶æ˜¾ç¤ºè¿›åº¦ | âœ… |
| ç¼“å­˜ç®¡ç† | è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ° | âœ… |
| ç»Ÿè®¡æŠ¥å‘Š | å®Œæˆåæ˜¾ç¤ºç»Ÿè®¡ | âœ… |

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: äº¤äº’å¼ä¸‹è½½ï¼ˆæ¨èï¼‰

```bash
chmod +x scripts/download_data.sh
./scripts/download_data.sh
```

æŒ‰æç¤ºé€‰æ‹©å¸‚åœºã€æ•°é‡ã€æ—¥æœŸç­‰å‚æ•°ã€‚

### æ–¹æ³•2: å‘½ä»¤è¡Œä¸‹è½½

```bash
# Aè‚¡1000åªï¼Œ2020-2025å¹´æ•°æ®
python scripts/batch_download_data.py \
    --market a \
    --total 1000 \
    --batch-size 50 \
    --start-date 2020-01-01 \
    --end-date 2025-11-04

# æ¸¯è‚¡500åª
python scripts/batch_download_data.py \
    --market hk \
    --total 500 \
    --batch-size 50 \
    --start-date 2020-01-01 \
    --end-date 2025-11-04

# å…¨éƒ¨å¸‚åœº
python scripts/batch_download_data.py \
    --market all \
    --total 1000 \
    --batch-size 50 \
    --start-date 2020-01-01 \
    --end-date 2025-11-04
```

## ğŸ“Š å‚æ•°é…ç½®

### å¿…é€‰å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| --market | å¸‚åœºç±»å‹ | a |
| --total | è‚¡ç¥¨æ•°é‡ | 1000 |
| --batch-size | æ‰¹æ¬¡å¤§å° | 50 |
| --start-date | å¼€å§‹æ—¥æœŸ | 2020-01-01 |
| --end-date | ç»“æŸæ—¥æœŸ | 2025-11-04 |

### å¯é€‰å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| --token | Tushare Token | ä»configè¯»å– |
| --cache-dir | ç¼“å­˜ç›®å½• | ./data |

## â±ï¸ æ—¶é—´ä¸æ•°æ®é‡ä¼°ç®—

### ä¸‹è½½æ—¶é—´

| åœºæ™¯ | è‚¡ç¥¨æ•° | å¹´ä»½ | æ‰¹æ¬¡ | æ—¶é—´ |
|------|--------|------|------|------|
| å¿«é€Ÿæµ‹è¯• | 10 | 1å¹´ | 1 | 1-2åˆ†é’Ÿ |
| å°è§„æ¨¡ | 100 | 1å¹´ | 2 | 3-5åˆ†é’Ÿ |
| ä¸­è§„æ¨¡ | 500 | 5å¹´ | 10 | 15-20åˆ†é’Ÿ |
| **å¤§è§„æ¨¡** | **1000** | **5å¹´** | **20** | **30-40åˆ†é’Ÿ** |
| è¶…å¤§è§„æ¨¡ | 2000 | 5å¹´ | 40 | 60-80åˆ†é’Ÿ |

### æ•°æ®å¤§å°

| è‚¡ç¥¨æ•° | å¹´ä»½ | ä¼°ç®—å¤§å° |
|--------|------|---------|
| 100 | 5å¹´ | ~25MB |
| 500 | 5å¹´ | ~125MB |
| 1000 | 5å¹´ | ~250MB |
| 2000 | 5å¹´ | ~500MB |
| 5000 | 5å¹´ | ~1.25GB |

## ğŸ›¡ï¸ APIé™æµå¤„ç†

### ä¿æŠ¤æœºåˆ¶

1. **é¢‘ç‡æ§åˆ¶**
   - æ¯æ¬¡APIè°ƒç”¨é—´éš”: 0.5ç§’
   - æ¯åˆ†é’Ÿè°ƒç”¨é™åˆ¶: 180æ¬¡
   - è¾¾åˆ°é™åˆ¶è‡ªåŠ¨ç­‰å¾…: 60ç§’

2. **æ‰¹æ¬¡ç®¡ç†**
   - æ¯æ‰¹é»˜è®¤: 50åªè‚¡ç¥¨
   - æ‰¹æ¬¡é—´ç­‰å¾…: 60ç§’
   - è‡ªåŠ¨é‡ç½®è®¡æ•°å™¨

3. **æ™ºèƒ½é‡è¯•**
   - æœ€å¤§é‡è¯•æ¬¡æ•°: 3æ¬¡
   - é‡è¯•é—´éš”: 5ç§’
   - é™æµé”™è¯¯ç«‹å³ç­‰å¾…

### æ¨èè®¾ç½®

| åœºæ™¯ | batch-size | è¯´æ˜ |
|------|-----------|------|
| ä¿å®ˆï¼ˆç¨³å®šï¼‰ | 20-30 | æ›´æ…¢ä½†æ›´ç¨³å®š |
| **æ¨è** | **50** | **å¹³è¡¡é€Ÿåº¦å’Œç¨³å®šæ€§** |
| æ¿€è¿›ï¼ˆå¿«é€Ÿï¼‰ | 80-100 | æ›´å¿«ä½†å¯èƒ½é™æµ |

## ğŸ’¾ æ•°æ®å­˜å‚¨

### ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ stock_daily/
â”‚   â”œâ”€â”€ 000001.SZ.csv      # Aè‚¡
â”‚   â”œâ”€â”€ 000002.SZ.csv
â”‚   â”œâ”€â”€ 00700.HK.csv       # æ¸¯è‚¡
â”‚   â”œâ”€â”€ AAPL.O.csv         # ç¾è‚¡
â”‚   â””â”€â”€ ...
â””â”€â”€ stock_list_a_20251104_153045.csv  # è‚¡ç¥¨åˆ—è¡¨
```

### æ•°æ®æ ¼å¼

æ¯ä¸ªCSVæ–‡ä»¶åŒ…å«ï¼š
- ts_code: è‚¡ç¥¨ä»£ç 
- trade_date: äº¤æ˜“æ—¥æœŸ
- open: å¼€ç›˜ä»·
- high: æœ€é«˜ä»·
- low: æœ€ä½ä»·
- close: æ”¶ç›˜ä»·
- volume: æˆäº¤é‡
- amount: æˆäº¤é¢

## ğŸ” è¿›åº¦ç›‘æ§

### å®æ—¶è¾“å‡º

```
======================================================================
æ‰¹æ¬¡ 1/20
å¤„ç†è‚¡ç¥¨: 1-50/1000
======================================================================
ä¸‹è½½ 000001.SZ (Aè‚¡) æ•°æ®: 2020-01-01 è‡³ 2025-11-04
âœ“ 000001.SZ ä¸‹è½½æˆåŠŸï¼Œæ•°æ®é‡: 1423
ä¸‹è½½ 000002.SZ (Aè‚¡) æ•°æ®: 2020-01-01 è‡³ 2025-11-04
âœ“ 000002.SZ ä¸‹è½½æˆåŠŸï¼Œæ•°æ®é‡: 1420
...
æ‰¹æ¬¡ 1 å®Œæˆï¼Œè€—æ—¶: 95.3ç§’
ç­‰å¾… 60 ç§’åç»§ç»­ä¸‹ä¸€æ‰¹æ¬¡...
```

### å®Œæˆç»Ÿè®¡

```
======================================================================
ä¸‹è½½å®Œæˆ!
æ€»è®¡: 1000 åªè‚¡ç¥¨
æˆåŠŸ: 950 åª
è·³è¿‡: 30 åª (å·²æœ‰ç¼“å­˜)
å¤±è´¥: 20 åª
======================================================================

ç¼“å­˜ç»Ÿè®¡:
  è‚¡ç¥¨æ•°æ®æ–‡ä»¶: 980
  æ€»å¤§å°: 245.6 MB
======================================================================
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### 1. å¿«é€Ÿæµ‹è¯•ï¼ˆ1-2åˆ†é’Ÿï¼‰

```bash
# ä¸‹è½½10åªAè‚¡2024å¹´æ•°æ®
python scripts/batch_download_data.py \
    --market a \
    --total 10 \
    --batch-size 10 \
    --start-date 2024-01-01 \
    --end-date 2024-10-31
```

### 2. æ ‡å‡†ä½¿ç”¨ï¼ˆ30-40åˆ†é’Ÿï¼‰

```bash
# ä¸‹è½½1000åªAè‚¡2020-2025å¹´æ•°æ®
python scripts/batch_download_data.py \
    --market a \
    --total 1000 \
    --batch-size 50 \
    --start-date 2020-01-01 \
    --end-date 2025-11-04
```

### 3. åå°è¿è¡Œï¼ˆæ¨èå¤§è§„æ¨¡ï¼‰

```bash
# ä½¿ç”¨nohupåå°è¿è¡Œ
nohup python scripts/batch_download_data.py \
    --market a \
    --total 2000 \
    --batch-size 50 \
    --start-date 2020-01-01 \
    --end-date 2025-11-04 \
    > download.log 2>&1 &

# æŸ¥çœ‹è¿›åº¦
tail -f download.log
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. APIæƒé™

| å¸‚åœº | æƒé™è¦æ±‚ | Tushareç§¯åˆ† |
|------|----------|-------------|
| Aè‚¡ | âœ… åŸºç¡€æƒé™ | 0åˆ†å³å¯ |
| æ¸¯è‚¡ | âœ… åŸºç¡€æƒé™ | 0åˆ†å³å¯ |
| ç¾è‚¡ | âš ï¸ é«˜çº§æƒé™ | éœ€è¦120åˆ†+ |

### 2. ç½‘ç»œè¦æ±‚

- ç¨³å®šçš„ç½‘ç»œè¿æ¥
- ä¸è¦é¢‘ç¹åˆ‡æ¢ç½‘ç»œ
- å»ºè®®ä½¿ç”¨æœ‰çº¿ç½‘ç»œ

### 3. ç£ç›˜ç©ºé—´

é¢„ç•™è¶³å¤Ÿç©ºé—´ï¼š
- 1000åªÃ—5å¹´ â‰ˆ 250MB
- 2000åªÃ—5å¹´ â‰ˆ 500MB
- 5000åªÃ—5å¹´ â‰ˆ 1.25GB

### 4. è¿è¡Œå»ºè®®

- é¦–æ¬¡ä½¿ç”¨å…ˆå°è§„æ¨¡æµ‹è¯•
- å¤§è§„æ¨¡ä¸‹è½½ä½¿ç”¨åå°è¿è¡Œ
- å¯ä»¥ä½¿ç”¨Ctrl+Cä¼˜é›…ä¸­æ–­
- ä¸­æ–­åé‡æ–°è¿è¡Œä¼šæ–­ç‚¹ç»­ä¼ 

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: Tokené”™è¯¯

```
ValueError: Tushare token is required
```

**è§£å†³**:
```bash
# åœ¨å‘½ä»¤ä¸­æŒ‡å®štoken
python scripts/batch_download_data.py --token your_token_here
```

### é—®é¢˜2: APIé™æµ

```
æŠ±æ­‰ï¼Œæ‚¨æ¯åˆ†é’Ÿæœ€å¤šè®¿é—®200æ¬¡
```

**è§£å†³**: è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†ï¼Œç­‰å¾…60ç§’åç»§ç»­

### é—®é¢˜3: ç¾è‚¡ä¸‹è½½å¤±è´¥

```
ç¾è‚¡æ•°æ®è·å–å¤±è´¥ï¼ˆå¯èƒ½éœ€è¦æ›´é«˜æƒé™ï¼‰
```

**è§£å†³**: 
- å‡çº§Tushareæƒé™
- æˆ–åªä¸‹è½½Aè‚¡/æ¸¯è‚¡

### é—®é¢˜4: ä¸‹è½½ä¸­æ–­

**è§£å†³**: é‡æ–°è¿è¡Œç›¸åŒå‘½ä»¤ï¼Œå·²ä¸‹è½½æ•°æ®ä¼šè‡ªåŠ¨è·³è¿‡

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| [æ‰¹é‡ä¸‹è½½æ•°æ®æŒ‡å—](./æ‰¹é‡ä¸‹è½½æ•°æ®æŒ‡å—.md) | è¯¦ç»†ä½¿ç”¨æŒ‡å— |
| [scripts/README.md](../scripts/README.md) | è„šæœ¬è¯´æ˜ |
| [æ•°æ®ç¼“å­˜ä½¿ç”¨æŒ‡å—](./æ•°æ®ç¼“å­˜ä½¿ç”¨æŒ‡å—.md) | ç¼“å­˜ç®¡ç† |
| [data/README.md](../data/README.md) | æ•°æ®ç›®å½•è¯´æ˜ |

## ğŸ¯ æ¨èå·¥ä½œæµ

### ç¬¬ä¸€æ­¥ï¼šæµ‹è¯•éªŒè¯ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python scripts/test_download.py

# æˆ–å¿«é€Ÿæµ‹è¯•ä¸‹è½½
python scripts/batch_download_data.py \
    --market a --total 10 \
    --start-date 2024-01-01 --end-date 2024-10-31
```

### ç¬¬äºŒæ­¥ï¼šæ­£å¼ä¸‹è½½ï¼ˆ30-40åˆ†é’Ÿï¼‰

```bash
# åå°è¿è¡Œ
nohup python scripts/batch_download_data.py \
    --market a --total 1000 \
    --start-date 2020-01-01 --end-date 2025-11-04 \
    > download.log 2>&1 &

# ç›‘æ§è¿›åº¦
tail -f download.log
```

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ•°æ®

```bash
# æ£€æŸ¥æ–‡ä»¶æ•°é‡
ls -1 data/stock_daily/ | wc -l

# æŸ¥çœ‹æ•°æ®å¤§å°
du -sh data/

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
python -c "
from src.data.data_cache import DataCache
stats = DataCache().get_cache_stats()
print(f'è‚¡ç¥¨æ•°: {stats[\"stock_daily_count\"]}')
print(f'å¤§å°: {stats[\"total_size_mb\"]} MB')
"
```

## âœ… åŠŸèƒ½æ¸…å•

- [x] æ”¯æŒAè‚¡/æ¸¯è‚¡/ç¾è‚¡å¤šå¸‚åœº
- [x] åˆ†æ‰¹æ¬¡ä¸‹è½½é¿å…é™æµ
- [x] æ™ºèƒ½é‡è¯•æœºåˆ¶
- [x] æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- [x] å®æ—¶è¿›åº¦æ˜¾ç¤º
- [x] å®Œæˆç»Ÿè®¡æŠ¥å‘Š
- [x] APIé™æµä¿æŠ¤
- [x] è‡ªåŠ¨ç¼“å­˜ç®¡ç†
- [x] äº¤äº’å¼è„šæœ¬
- [x] åå°è¿è¡Œæ”¯æŒ
- [x] å®Œæ•´æ–‡æ¡£

## ğŸ‰ æ€»ç»“

**æ‰¹é‡ä¸‹è½½ç³»ç»Ÿå·²å®Œå…¨å°±ç»ªï¼**

æ ¸å¿ƒä¼˜åŠ¿ï¼š
- ğŸš€ **é«˜æ•ˆ**: åˆ†æ‰¹å¹¶å‘ï¼Œ30-40åˆ†é’Ÿä¸‹è½½1000åªè‚¡ç¥¨
- ğŸ›¡ï¸ **ç¨³å®š**: å®Œå–„çš„é™æµä¿æŠ¤å’Œé‡è¯•æœºåˆ¶
- ğŸ’¾ **æ™ºèƒ½**: è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ ï¼ŒèŠ‚çœæ—¶é—´
- ğŸ“Š **å…¨é¢**: æ”¯æŒAè‚¡/æ¸¯è‚¡/ç¾è‚¡å¤šå¸‚åœº
- ğŸ“– **æ˜“ç”¨**: äº¤äº’å¼ç•Œé¢ï¼Œè¯¦ç»†æ–‡æ¡£

ç«‹å³å¼€å§‹ï¼š
```bash
./scripts/download_data.sh
```

æˆ–ï¼š
```bash
python scripts/batch_download_data.py --market a --total 1000
```

ç¥ä½¿ç”¨é¡ºåˆ©ï¼ğŸš€
