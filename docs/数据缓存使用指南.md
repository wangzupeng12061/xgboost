# æ•°æ®ç¼“å­˜å¿«é€Ÿå‚è€ƒ

> å¦‚ä½•ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘APIè°ƒç”¨ï¼Œæé«˜æ•°æ®åŠ è½½é€Ÿåº¦

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯ç”¨ç¼“å­˜ï¼ˆæ¨èï¼‰

ç¼–è¾‘ `config/config.yaml`:

```yaml
data:
  cache:
    enabled: true           # å¯ç”¨ç¼“å­˜
    cache_dir: "./data"     # ç¼“å­˜ç›®å½•
    expire_days: 7          # 7å¤©åè¿‡æœŸ
    auto_update: true       # è‡ªåŠ¨æ›´æ–°è¿‡æœŸæ•°æ®
```

### 2. è¿è¡Œç¨‹åº

```bash
python main.py
```

**é¦–æ¬¡è¿è¡Œï¼š**
- ä»Tushare APIè·å–æ•°æ®ï¼ˆè¾ƒæ…¢ï¼Œçº¦3-5åˆ†é’Ÿï¼‰
- è‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ° `data/` ç›®å½•

**åç»­è¿è¡Œï¼š**
- ä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼ˆå¿«é€Ÿï¼Œçº¦10-20ç§’ï¼‰
- å¦‚æœæ•°æ®è¿‡æœŸï¼Œè‡ªåŠ¨æ›´æ–°

---

## ğŸ“‚ ç¼“å­˜ç›®å½•ç»“æ„

```
data/
â”œâ”€â”€ stock_daily/          # è‚¡ç¥¨æ—¥çº¿æ•°æ®
â”‚   â”œâ”€â”€ 000001.SZ.csv    # æ¯åªè‚¡ç¥¨ä¸€ä¸ªæ–‡ä»¶
â”‚   â”œâ”€â”€ 000002.SZ.csv
â”‚   â””â”€â”€ ...
â”œâ”€â”€ stock_basic/          # è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯
â”‚   â””â”€â”€ stock_basic.csv
â”œâ”€â”€ index_daily/          # æŒ‡æ•°æ•°æ®
â”‚   â””â”€â”€ 000300.SH.csv    # æ²ªæ·±300
â”œâ”€â”€ macro/                # å®è§‚æ•°æ®
â”‚   â”œâ”€â”€ m1.csv
â”‚   â”œâ”€â”€ m2.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ financial/            # è´¢åŠ¡æ•°æ®
    â”œâ”€â”€ income.csv
    â”œâ”€â”€ balance.csv
    â””â”€â”€ cashflow.csv
```

---

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```python
from src.data.data_cache import DataCache

cache = DataCache()
stats = cache.get_cache_stats()

print(f"ç¼“å­˜å¤§å°: {stats['total_size_mb']} MB")
print(f"è‚¡ç¥¨æ•°æ®: {stats['stock_daily_count']} ä¸ªæ–‡ä»¶")
```

### æ¸…é™¤ç¼“å­˜

```bash
# æ–¹æ³•1: åˆ é™¤æ•´ä¸ªdataç›®å½•
rm -rf data/

# æ–¹æ³•2: åªåˆ é™¤è‚¡ç¥¨æ—¥çº¿æ•°æ®
rm -rf data/stock_daily/

# æ–¹æ³•3: ä½¿ç”¨Python
python -c "from src.data.data_cache import DataCache; DataCache().clear_cache()"
```

### å¼ºåˆ¶æ›´æ–°æ•°æ®

```bash
# åˆ é™¤ç¼“å­˜ï¼Œä¸‹æ¬¡è¿è¡Œè‡ªåŠ¨é‡æ–°ä¸‹è½½
rm -rf data/

python main.py
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### expire_daysï¼ˆè¿‡æœŸå¤©æ•°ï¼‰

| å€¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|----|------|---------|
| 0 | æ°¸ä¸è¿‡æœŸ | å†å²å›æµ‹ï¼Œæ•°æ®ä¸å˜ |
| 1 | 1å¤©è¿‡æœŸ | æ—¥å†…æ•°æ®æ›´æ–° |
| 7 | 7å¤©è¿‡æœŸ | å‘¨åº¦æ›´æ–°ï¼ˆæ¨èï¼‰ |
| 30 | 30å¤©è¿‡æœŸ | æœˆåº¦æ›´æ–° |

### auto_updateï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰

- `true`: æ•°æ®è¿‡æœŸæ—¶è‡ªåŠ¨ä»APIæ›´æ–°ï¼ˆæ¨èï¼‰
- `false`: æ•°æ®è¿‡æœŸä»ä½¿ç”¨æœ¬åœ°ç¼“å­˜

---

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. åŠ é€Ÿé¦–æ¬¡è¿è¡Œ

**åˆ†æ‰¹ä¸‹è½½ï¼š**
```bash
# å…ˆä¸‹è½½å°‘é‡è‚¡ç¥¨
# ä¿®æ”¹ main.pyï¼Œé™åˆ¶è‚¡ç¥¨æ± ä¸º10åª
python main.py

# ç¡®è®¤æ­£å¸¸åï¼Œå†å¢åŠ åˆ°30åª
python main.py
```

### 2. å¤‡ä»½é‡è¦æ•°æ®

```bash
# åˆ›å»ºå¤‡ä»½
tar -czf data_backup_$(date +%Y%m%d).tar.gz data/

# æ¢å¤å¤‡ä»½
tar -xzf data_backup_20241104.tar.gz
```

### 3. ä¸Gité…åˆ

`data/` ç›®å½•å·²åŠ å…¥ `.gitignore`ï¼Œä¸ä¼šæäº¤åˆ°Gitã€‚

ä¿ç•™READMEï¼š
```bash
git add data/README.md
git commit -m "Add data cache documentation"
```

### 4. èŠ‚çœç£ç›˜ç©ºé—´

```bash
# åªä¿ç•™æœ€è¿‘çš„æ•°æ®
find data/stock_daily -name "*.csv" -mtime +30 -delete

# å‹ç¼©æ—§æ•°æ®
tar -czf data_archive_$(date +%Y%m%d).tar.gz data/
rm -rf data/
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | æ— ç¼“å­˜ | æœ‰ç¼“å­˜ | æå‡ |
|------|-------|--------|-----|
| 30åªè‚¡ç¥¨ï¼Œ1å¹´æ•°æ® | 3-5åˆ†é’Ÿ | 10-20ç§’ | 10-15å€ |
| 50åªè‚¡ç¥¨ï¼Œ2å¹´æ•°æ® | 8-15åˆ†é’Ÿ | 30-60ç§’ | 10-15å€ |
| é‡å¤è¿è¡Œå›æµ‹ | æ¯æ¬¡3-5åˆ†é’Ÿ | æ¯æ¬¡10-20ç§’ | æå¤§æå‡ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. APIé™æµä»å­˜åœ¨

ç¼“å­˜**å‡å°‘**ä½†**ä¸èƒ½å®Œå…¨é¿å…**APIè°ƒç”¨ï¼š
- é¦–æ¬¡è¿è¡Œä»éœ€ä¸‹è½½æ•°æ®
- æ•°æ®è¿‡æœŸéœ€è¦æ›´æ–°

### 2. æ•°æ®ä¸€è‡´æ€§

**é‡è¦ï¼š** åŒä¸€æ‰¹å›æµ‹åº”ä½¿ç”¨ç›¸åŒçš„æ•°æ®å¿«ç…§ï¼

```bash
# å›æµ‹å‰ç¦ç”¨è‡ªåŠ¨æ›´æ–°
# ç¼–è¾‘ config.yaml
data:
  cache:
    auto_update: false  # å…³é—­è‡ªåŠ¨æ›´æ–°
    expire_days: 0      # æ°¸ä¸è¿‡æœŸ
```

### 3. ç£ç›˜ç©ºé—´

ä¼°ç®—æ•°æ®å¤§å°ï¼š
- 30åªè‚¡ç¥¨Ã—10å¹´ â‰ˆ 15MB
- 100åªè‚¡ç¥¨Ã—10å¹´ â‰ˆ 50MB
- å…¨å¸‚åœº5000åªÃ—10å¹´ â‰ˆ 2.5GB

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: ç¼“å­˜è¯»å–å¤±è´¥

```
WARNING: è¯»å–ç¼“å­˜å¤±è´¥: stock_daily_000001.SZ
```

**è§£å†³ï¼š**
```bash
# åˆ é™¤æŸåçš„ç¼“å­˜
rm data/stock_daily/000001.SZ.csv
rm data/.stock_daily_000001.SZ.info

# é‡æ–°è¿è¡Œ
python main.py
```

### é—®é¢˜2: æ•°æ®ä¸æ›´æ–°

**æ£€æŸ¥é…ç½®ï¼š**
```yaml
data:
  cache:
    expire_days: 0  # æ”¹ä¸º 7
    auto_update: false  # æ”¹ä¸º true
```

### é—®é¢˜3: ç¼“å­˜å ç”¨è¿‡å¤šç©ºé—´

```bash
# æŸ¥çœ‹ç¼“å­˜å¤§å°
du -sh data/

# æ¸…ç†ä¸éœ€è¦çš„æ•°æ®
rm -rf data/financial/  # ä¸ç”¨è´¢åŠ¡æ•°æ®
rm -rf data/macro/      # ä¸ç”¨å®è§‚æ•°æ®
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [data/README.md](../data/README.md) - æ•°æ®ç›®å½•è¯¦ç»†è¯´æ˜
- [å®Œæ•´ä½¿ç”¨æŒ‡å—](./å®Œæ•´ä½¿ç”¨æŒ‡å—.md) - ç³»ç»Ÿä½¿ç”¨æŒ‡å—
- [data_cache_example.py](../examples/data_cache_example.py) - ä»£ç ç¤ºä¾‹

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨ç¼“å­˜å‰ç¡®è®¤ï¼š

- [ ] å·²åˆ›å»º `data/` ç›®å½•
- [ ] å·²åœ¨ `config.yaml` ä¸­å¯ç”¨ç¼“å­˜
- [ ] å·²è®¾ç½®åˆé€‚çš„ `expire_days`
- [ ] å·²é…ç½® `auto_update`
- [ ] é¦–æ¬¡è¿è¡Œå‰å·²åšå¥½ç­‰å¾…å‡†å¤‡ï¼ˆ3-5åˆ†é’Ÿï¼‰
- [ ] äº†è§£ `.gitignore` å·²æ’é™¤ `data/` ç›®å½•

---

**æç¤ºï¼š** ç¼“å­˜æ˜¯æå‡å¼€å‘æ•ˆç‡çš„åˆ©å™¨ï¼Œåˆç†ä½¿ç”¨å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ï¼ğŸš€
